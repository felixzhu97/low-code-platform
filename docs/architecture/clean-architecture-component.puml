@startuml
!theme plain
skinparam component {
  BackgroundColor<<domain>> #E8F5E9
  BackgroundColor<<application>> #E3F2FD
  BackgroundColor<<infrastructure>> #FFF3E0
  BackgroundColor<<presentation>> #F3E5F5
}

title 整洁架构 - 组件图（完整系统）

package "Presentation Layer" <<presentation>> {
  [Canvas Component] as Canvas
  [Component Panel] as ComponentPanel
  [Properties Panel] as PropertiesPanel
  [Component Adapter] as ComponentAdapter
  [Canvas Adapter] as CanvasAdapter
}

package "Application Layer" <<application>> {
  [Create Component\nUse Case] as CreateComponentUC
  [Update Component\nUse Case] as UpdateComponentUC
  [Delete Component\nUse Case] as DeleteComponentUC
  [Save Canvas\nUse Case] as SaveCanvasUC
  [Load Canvas\nUse Case] as LoadCanvasUC
  [Component Mapper] as ComponentMapper
  [Canvas Mapper] as CanvasMapper
}

package "Domain Layer" <<domain>> {
  [Component Entity] as ComponentEntity
  [Canvas Entity] as CanvasEntity
  [Component Factory\nService] as ComponentFactory
  [Component Validator\nService] as ComponentValidator
  interface "IComponent\nRepository" as IComponentRepo
  interface "ICanvas\nRepository" as ICanvasRepo
}

package "Infrastructure Layer" <<infrastructure>> {
  [LocalStorage Component\nRepository] as LSComponentRepo
  [LocalStorage Canvas\nRepository] as LSCanvasRepo
  [Zustand Canvas Store] as CanvasStore
  [Zustand Component Store] as ComponentStore
  [API Data Source] as APIDataSource
  [Static Data Source] as StaticDataSource
}

' Presentation to Application
ComponentAdapter --> CreateComponentUC
ComponentAdapter --> UpdateComponentUC
ComponentAdapter --> DeleteComponentUC
CanvasAdapter --> SaveCanvasUC
CanvasAdapter --> LoadCanvasUC

ComponentPanel --> ComponentAdapter
PropertiesPanel --> ComponentAdapter
Canvas --> CanvasAdapter

' Application to Domain
CreateComponentUC --> ComponentEntity
CreateComponentUC --> IComponentRepo
CreateComponentUC --> ComponentFactory
UpdateComponentUC --> IComponentRepo
UpdateComponentUC --> ComponentEntity
DeleteComponentUC --> IComponentRepo
SaveCanvasUC --> ICanvasRepo
SaveCanvasUC --> CanvasEntity
LoadCanvasUC --> ICanvasRepo
LoadCanvasUC --> CanvasEntity

CreateComponentUC --> ComponentMapper
UpdateComponentUC --> ComponentMapper
SaveCanvasUC --> CanvasMapper
LoadCanvasUC --> CanvasMapper

ComponentMapper --> ComponentEntity
CanvasMapper --> CanvasEntity

ComponentFactory --> ComponentEntity
ComponentFactory --> ComponentValidator
ComponentValidator --> ComponentEntity

' Domain Interfaces
IComponentRepo --> ComponentEntity
ICanvasRepo --> CanvasEntity

' Infrastructure implements Domain
LSComponentRepo ..|> IComponentRepo
LSCanvasRepo ..|> ICanvasRepo

' Infrastructure to Application (via ports)
CanvasStore ..> SaveCanvasUC : implements port
ComponentStore ..> CreateComponentUC : implements port

' Data Sources
APIDataSource ..> CreateComponentUC : implements port
StaticDataSource ..> CreateComponentUC : implements port

note right of ComponentEntity
  领域实体
  业务核心
end note

note right of CreateComponentUC
  应用用例
  业务编排
end note

note right of LSComponentRepo
  基础设施实现
  技术细节
end note

@enduml

