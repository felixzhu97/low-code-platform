@startuml
!theme plain
skinparam sequenceArrowThickness 2
skinparam roundcorner 10
skinparam maxmessagesize 60

title 整洁架构 - 序列图（创建组件用例）

actor User as user
participant "ComponentPanel\n(Presentation)" as panel
participant "ComponentAdapter\n(Presentation)" as adapter
participant "CreateComponentUseCase\n(Application)" as useCase
participant "ComponentFactoryService\n(Domain)" as factory
participant "IComponentRepository\n(Domain Interface)" as repositoryInterface
participant "LocalStorageComponentRepository\n(Infrastructure)" as repositoryImpl

user -> panel: 点击"创建按钮"组件
activate panel

panel -> adapter: createComponent("button", "Submit")
activate adapter

adapter -> useCase: execute({ type: "button", name: "Submit" })
activate useCase

useCase -> factory: create("button", "Submit", {})
activate factory
factory -> factory: 创建 ComponentEntity
factory --> useCase: ComponentEntity
deactivate factory

useCase -> useCase: 验证组件数据

useCase -> repositoryInterface: save(component)
activate repositoryInterface
repositoryInterface -> repositoryImpl: save(component)
activate repositoryImpl
repositoryImpl -> repositoryImpl: 序列化为 JSON
repositoryImpl -> repositoryImpl: 保存到 LocalStorage
repositoryImpl --> repositoryInterface: Promise<void>
deactivate repositoryImpl
repositoryInterface --> useCase: Promise<void>
deactivate repositoryInterface

useCase --> adapter: ComponentEntity
deactivate useCase

adapter -> adapter: 转换为 ComponentDTO
adapter --> panel: ComponentDTO
deactivate adapter

panel -> panel: 更新UI显示新组件
panel --> user: 显示新组件
deactivate panel

note over panel, repositoryImpl
  依赖方向：
  Presentation → Application → Domain
  Infrastructure 实现 Domain 接口
end note

@enduml

