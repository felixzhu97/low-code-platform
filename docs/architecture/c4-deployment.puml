@startuml C4_Deployment
!include c4-plantuml/C4_Container.puml

title Deployment Diagram - Felix 低代码平台

System_Boundary(client, "客户端环境", "Web 浏览器、移动设备") {
    Container(web_browser, "Web 浏览器", "Chrome, Firefox, Safari", "运行前端应用")
}

System_Boundary(edge, "边缘网络", "CDN 节点") {
    Container(cdn_cache, "CDN 缓存", "Cloudflare, AWS CloudFront", "缓存静态资源")
}

System_Boundary(cloud, "云计算平台", "Kubernetes 集群") {
    System_Boundary(web_tier, "Web 层", "Kubernetes Pods") {
        Container(web_app, "Web 应用", "Next.js", "提供前端界面和 API")
        Container(api_server, "API 服务器", "Next.js API Routes", "处理业务逻辑")
    }

    System_Boundary(ws_tier, "WebSocket 层", "Kubernetes Pods") {
        Container(websocket_server, "WebSocket 服务器", "Node.js", "处理实时通信")
    }

    System_Boundary(data_tier, "数据层", "托管服务") {
        ContainerDb(postgresql, "PostgreSQL", "数据库", "存储业务数据")
        ContainerDb(redis, "Redis", "缓存", "缓存热点数据")
    }

    System_Boundary(storage_tier, "存储层", "对象存储") {
        ContainerDb(s3, "对象存储", "S3/OSS", "存储文件和资源")
    }

    System_Boundary(monitor_tier, "监控层", "监控服务") {
        Container(monitoring, "监控服务", "Prometheus + Grafana", "系统监控和告警")
    }
}

System_Boundary(external, "外部服务", "第三方服务") {
    System_Ext(auth_service, "认证服务", "OAuth 2.0")
    System_Ext(code_repo, "代码托管", "GitHub, GitLab")
    System_Ext(analytics, "分析服务", "Google Analytics")
}

Rel(web_browser, cdn_cache, "获取资源", "HTTPS")
Rel(web_browser, web_app, "访问", "HTTPS")
Rel(web_browser, websocket_server, "连接", "WebSocket")

Rel(cdn_cache, web_app, "回源", "HTTPS")

Rel(web_app, api_server, "调用", "HTTP")
Rel(api_server, postgresql, "读写", "SQL")
Rel(api_server, redis, "读写", "Redis Protocol")
Rel(api_server, s3, "读写", "HTTPS")
Rel(api_server, auth_service, "验证", "HTTPS")
Rel(api_server, code_repo, "导出", "HTTPS/SSH")

Rel(websocket_server, postgresql, "读写", "SQL")
Rel(websocket_server, redis, "读写", "Redis Protocol")

Rel(web_app, monitoring, "上报指标", "HTTP")
Rel(api_server, monitoring, "上报指标", "HTTP")

SHOW_LEGEND()

@enduml

