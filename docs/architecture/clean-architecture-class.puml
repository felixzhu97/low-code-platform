@startuml
!theme plain
skinparam classAttributeIconSize 0
skinparam shadowing false

title 整洁架构 - 类图（组件管理示例）

package "Domain Layer" {
  class ComponentEntity {
    - id: string
    - type: string
    - name: string
    - properties: ComponentProperties
    - position: Position
    + updateProperties(properties): ComponentEntity
    + moveTo(position: Position): ComponentEntity
  }

  class ComponentProperties {
    + [key: string]: any
  }

  class Position {
    + x: number
    + y: number
  }

  interface IComponentRepository {
    + save(component: ComponentEntity): Promise<void>
    + findById(id: string): Promise<ComponentEntity | null>
    + findAll(): Promise<ComponentEntity[]>
    + delete(id: string): Promise<void>
  }

  class ComponentFactoryService {
    + create(type: string, name: string, properties: any): ComponentEntity
    + validate(component: ComponentEntity): void
  }

  ComponentEntity *-- ComponentProperties
  ComponentEntity *-- Position
  ComponentFactoryService ..> ComponentEntity
  IComponentRepository ..> ComponentEntity
}

package "Application Layer" {
  class CreateComponentUseCase {
    - repository: IComponentRepository
    - factory: ComponentFactoryService
    + execute(command: CreateComponentCommand): Promise<ComponentEntity>
  }

  class UpdateComponentUseCase {
    - repository: IComponentRepository
    + execute(command: UpdateComponentCommand): Promise<ComponentEntity>
  }

  class DeleteComponentUseCase {
    - repository: IComponentRepository
    + execute(command: DeleteComponentCommand): Promise<void>
  }

  class CreateComponentCommand {
    + type: string
    + name: string
    + properties: any
  }

  class ComponentDTO {
    + id: string
    + type: string
    + name: string
    + properties: any
  }

  class ComponentMapper {
    + toDTO(entity: ComponentEntity): ComponentDTO
    + toEntity(dto: ComponentDTO): ComponentEntity
  }

  CreateComponentUseCase --> IComponentRepository
  CreateComponentUseCase --> ComponentFactoryService
  UpdateComponentUseCase --> IComponentRepository
  DeleteComponentUseCase --> IComponentRepository
  CreateComponentUseCase ..> CreateComponentCommand
  ComponentMapper ..> ComponentEntity
  ComponentMapper ..> ComponentDTO
}

package "Infrastructure Layer" {
  class LocalStorageComponentRepository {
    - storage: Storage
    + save(component: ComponentEntity): Promise<void>
    + findById(id: string): Promise<ComponentEntity | null>
    + findAll(): Promise<ComponentEntity[]>
    + delete(id: string): Promise<void>
  }

  LocalStorageComponentRepository ..|> IComponentRepository
}

package "Presentation Layer" {
  class ComponentAdapter {
    - createUseCase: CreateComponentUseCase
    - updateUseCase: UpdateComponentUseCase
    - deleteUseCase: DeleteComponentUseCase
    + createComponent(type: string, name: string): Promise<ComponentDTO>
    + updateComponent(id: string, properties: any): Promise<ComponentDTO>
    + deleteComponent(id: string): Promise<void>
  }

  class ComponentPanel {
    - adapter: ComponentAdapter
    + handleCreate()
    + handleUpdate()
    + handleDelete()
  }

  ComponentAdapter --> CreateComponentUseCase
  ComponentAdapter --> UpdateComponentUseCase
  ComponentAdapter --> DeleteComponentUseCase
  ComponentPanel --> ComponentAdapter
}

note right of ComponentEntity
  领域实体
  包含业务逻辑
end note

note right of CreateComponentUseCase
  应用用例
  编排业务逻辑
end note

note right of LocalStorageComponentRepository
  基础设施实现
  实现仓储接口
end note

note right of ComponentAdapter
  适配器
  连接UI和用例
end note

@enduml

